(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{445:function(s,t,a){"use strict";a.r(t);var n=a(19),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("[toc]")]),s._v(" "),a("h2",{attrs:{id:"docker概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker概述"}},[s._v("#")]),s._v(" Docker概述")]),s._v(" "),a("h3",{attrs:{id:"docker为什么会出现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker为什么会出现"}},[s._v("#")]),s._v(" Docker为什么会出现？")]),s._v(" "),a("ul",[a("li",[s._v("一款产品：开发---上线，两套环境，不用应用配置")]),s._v(" "),a("li",[s._v("问题：我在我的电脑上可以运行，但由于版本更新或者其他因素，导致服务器中的服务不可用，对于运维来说，考验十分大")]),s._v(" "),a("li",[s._v("环境配置是十分的麻烦，没一个机器都要部署环境 (集群Redis，ES，Hadoop等等) 费时费力")]),s._v(" "),a("li",[s._v("项目能不能带上环境安装打包？")]),s._v(" "),a("li",[s._v("Docker给以上的问题提出了解决方案")]),s._v(" "),a("li",[s._v("java->jar(环境)->打包项目带上环境(镜像)->Docker仓库->运维下载我们发布的镜像->直接运行")]),s._v(" "),a("li",[s._v("Docker的思想就来自于集装箱\n"),a("ul",[a("li",[s._v("隔离：Docker核心思想，打包装箱，每个箱子是互相隔离的")])])])]),s._v(" "),a("h3",{attrs:{id:"docker的历史"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker的历史"}},[s._v("#")]),s._v(" Docker的历史")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("2010年，几个搞IT的年轻人，就在美国成立了一家公司"),a("code",[s._v("dotcloud")]),s._v("做一些PaaS的云计算服务，LXC有关的容器技术他们将自己的技术(容器化技术)命名就是Docker")])]),s._v(" "),a("li",[a("p",[s._v("Docker刚刚诞生的时候，没有引起行业的注意，于是开源")])]),s._v(" "),a("li",[a("p",[s._v("2013年，Docker开源了，越来越多的人发现了Docker的优点，所以就火了")])]),s._v(" "),a("li",[a("p",[s._v("2014年4月9日，Docker1.0发布")])]),s._v(" "),a("li",[a("p",[s._v("Docker为什么这么火：轻量级")])]),s._v(" "),a("li",[a("p",[s._v("在容器技术出来之前，我们都是使用虚拟机技术")])]),s._v(" "),a("li",[a("p",[s._v("虚拟机：在windows中装一个虚拟机软件，通过这个软件我们可以虚拟出来一台或多台电脑，但十分笨重")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("虚拟机也是属于虚拟化技术，Docker容器技术，也是一种虚拟化技术")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("vm：linux centos 原生镜像要达到隔离需要开启多个虚拟机  几个G  几分钟\ndocker：隔离，镜像(最核心的环境，不再是整个linux系统)十分的小巧，运行镜像即可达到隔离  几个M  秒级\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])])])]),s._v(" "),a("li",[a("p",[s._v("Docker是基于Go语言开发的，开源项目")])])]),s._v(" "),a("h3",{attrs:{id:"docker能干什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker能干什么"}},[s._v("#")]),s._v(" Docker能干什么")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("虚拟机技术缺点：")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("资源占用十分多")])]),s._v(" "),a("li",[a("p",[s._v("冗余步骤多")])]),s._v(" "),a("li",[a("p",[s._v("启动很慢")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Docker.assets/image-20210522190848909.png",alt:"image-20210522190848909"}})])])])]),s._v(" "),a("li",[a("p",[s._v("容器化技术")]),s._v(" "),a("ul",[a("li",[a("p",[a("strong",[s._v("容器化技术不是模拟的一个完整的系统")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/Docker.assets/image-20210522190928029.png",alt:"image-20210522190928029"}})])])])]),s._v(" "),a("li",[a("p",[s._v("比较Docker和虚拟机技术的不同：")]),s._v(" "),a("ul",[a("li",[s._v("传统虚拟机，虚拟出一套硬件，运行一个完整的操作系统，然后在这个系统上安装和运行软件")]),s._v(" "),a("li",[s._v("容器内的应用直接运行在宿主机的内核中，容器是没有自己的内核的，也没有虚拟我们的硬件，所以就很轻便")]),s._v(" "),a("li",[s._v("每个容器间是互相隔离的，每个容器内都有一个属于自己的文件系统，互不影响")])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("DevPos (开发，运维)")])])]),s._v(" "),a("li",[a("p",[s._v("应用更快速的交付和部署")])]),s._v(" "),a("li",[a("p",[s._v("传统：一推帮助文档，安装程序")])]),s._v(" "),a("li",[a("p",[s._v("Docker：打包镜像发布测试，一键进行")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("更便捷的升级和扩缩容")])])]),s._v(" "),a("li",[a("p",[s._v("使用了Docker之后，我们部署应用就和搭积木一样")])]),s._v(" "),a("li",[a("p",[s._v("更简单的系统运维")])]),s._v(" "),a("li",[a("p",[s._v("在容器化之后，我们的"),a("strong",[s._v("开发，测试环境都是高度一致的")])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("更高效的计算资源利用")])])]),s._v(" "),a("li",[a("p",[s._v("Docker是内核级别的虚拟化，"),a("strong",[s._v("可以在一个物理机上运行很多的容器实例")]),s._v("，服务器的性能可以被压榨到极致")])])]),s._v(" "),a("h2",{attrs:{id:"docker安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker安装"}},[s._v("#")]),s._v(" Docker安装")]),s._v(" "),a("h3",{attrs:{id:"docker的基本组成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker的基本组成"}},[s._v("#")]),s._v(" Docker的基本组成")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Docker.assets/image-20210821211406578.png",alt:"image-20210821211406578"}})]),s._v(" "),a("ul",[a("li",[s._v("Client：客户端\n"),a("ul",[a("li",[s._v("docker build：构建一个镜像")]),s._v(" "),a("li",[s._v("docker pull：拉取一个镜像")]),s._v(" "),a("li",[s._v("docker run：运行一个容器")])])]),s._v(" "),a("li",[s._v("Docker_Host：服务器\n"),a("ul",[a("li",[s._v("Docker deamon：docker守护进程")]),s._v(" "),a("li",[a("strong",[s._v("Images：镜像")]),s._v("，可以理解为.Class，全局唯一。通过这个镜像可以创建多个容器(最终服务运行或者项目运行就是在容器中的)")]),s._v(" "),a("li",[a("strong",[s._v("Containers：容器")]),s._v("，可以理解为对象。docker利用容器技术，通过镜像来创建独立运行的一个或者一个组应用\n"),a("ul",[a("li",[s._v("启动，停止，删除等基本命令")])])])])]),s._v(" "),a("li",[s._v("Repository：仓库，就是存放镜像的地方\n"),a("ul",[a("li",[s._v("分为公有仓库和私有仓库")])])])]),s._v(" "),a("h3",{attrs:{id:"安装docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装docker"}},[s._v("#")]),s._v(" 安装Docker")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("环境准备")]),s._v(" "),a("ul",[a("li",[s._v("需要会一点点Linux基础")]),s._v(" "),a("li",[s._v("CentOS7或者其他linux系统")]),s._v(" "),a("li",[s._v("使用Xshell连接远程服务器进行操作")])])]),s._v(" "),a("li",[a("p",[s._v("环境查看")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 系统内核是3.10以上最好")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# uname -r")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.10")]),s._v(".0-1127.el7.x86_64\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("安装步骤")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("卸载旧的版本")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum remove docker "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n                  docker-client "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n                  docker-client-latest "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n                  docker-common "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n                  docker-latest "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n                  docker-latest-logrotate "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n                  docker-logrotate "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n                  docker-engine\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("需要的安装包"),a("code",[s._v("yum install -y yum-utils")])])]),s._v(" "),a("li",[a("p",[s._v("设置镜像的仓库")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum-config-manager "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --add-repo "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    https://download.docker.com/linux/centos/docker-ce.repo "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认是国外的")]),s._v("\n\nyum-config-manager "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --add-repo "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\thttp://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 阿里云镜像")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("更新yum软件包索引"),a("code",[s._v("yum makecache fast")])])]),s._v(" "),a("li",[a("p",[s._v("安装docker引擎"),a("code",[s._v("yum install docker-ce docker-ce-cli containerd.io")])]),s._v(" "),a("ul",[a("li",[s._v("docker-ce指社区版，ee指企业版")]),s._v(" "),a("li",[s._v("也可以"),a("code",[s._v("yum list docker-ce --showduplicates | sort -r")]),s._v("列出docker版本")]),s._v(" "),a("li",[s._v("安装指定版本"),a("code",[s._v("yum install docker-ce-<VERSION_STRING> docker-ce-cli-<VERSION_STRING> containerd.io")])])])]),s._v(" "),a("li",[a("p",[s._v("使用"),a("code",[s._v("docker version")]),s._v("查看是否安装成功")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("systemctl enable docker")]),s._v("设置开机启动")])]),s._v(" "),a("li",[a("p",[s._v("启动docker"),a("code",[s._v("systemctl start docker")])])]),s._v(" "),a("li",[a("p",[s._v("测试运行"),a("code",[s._v("docker run hello-world")])])]),s._v(" "),a("li",[a("p",[s._v("通过"),a("code",[s._v("docker images")]),s._v("查看下载的这个hello-world镜像")])]),s._v(" "),a("li",[a("p",[s._v("卸载docker")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("卸载Docker引擎、CLI和Containerd包"),a("code",[s._v("yum remove docker-ce docker-ce-cli containerd.io")])])]),s._v(" "),a("li",[a("p",[s._v("主机上的镜像、容器、volumes或自定义配置文件不会自动删除。删除所有镜像、容器和volumes。必须手动删除任何已编辑的配置文件")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf /var/lib/docker\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf /var/lib/containerd\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /var/lib/docker|containerd docker的默认资源路径")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])])])])])])]),s._v(" "),a("h3",{attrs:{id:"阿里云镜像加速"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#阿里云镜像加速"}},[s._v("#")]),s._v(" 阿里云镜像加速")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("登录阿里云，找到容器镜像服务")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Docker.assets/image-20210523153557213.png",alt:"image-20210523153557213"}})])]),s._v(" "),a("li",[a("p",[s._v("找到镜像加速器")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Docker.assets/image-20210523153727078.png",alt:"image-20210523153727078"}})])]),s._v(" "),a("li",[a("p",[s._v("配置使用")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /etc/docker\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" /etc/docker/daemon.json "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<-")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'EOF\'\n{\n  "registry-mirrors": ["https://xxxxxx.com"]\n}\nEOF')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl daemon-reload\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart docker\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])])])]),s._v(" "),a("h3",{attrs:{id:"docker-run流程分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-run流程分析"}},[s._v("#")]),s._v(" docker run流程分析")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Docker.assets/image-20210523154454440.png",alt:"image-20210523154454440"}})]),s._v(" "),a("h2",{attrs:{id:"基本底层原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本底层原理"}},[s._v("#")]),s._v(" 基本底层原理")]),s._v(" "),a("h3",{attrs:{id:"docker是怎么工作的"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker是怎么工作的"}},[s._v("#")]),s._v(" Docker是怎么工作的")]),s._v(" "),a("ul",[a("li",[s._v("Docker是一个Client - Server结构的系统，Docker的守护进程运行在主机上，通过Socket从客户端访问。DockerServer接收到Docker-Client的指令后就会去执行")])]),s._v(" "),a("h3",{attrs:{id:"docker为什么比vm快"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker为什么比vm快"}},[s._v("#")]),s._v(" Docker为什么比VM快")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("docker有着比虚拟机更少的抽象层")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Docker.assets/image-20210523155925936.png",alt:"image-20210523155925936"}})])]),s._v(" "),a("li",[a("p",[s._v("docker利用的是宿主机的内核，vm需要的是Guest OS全部环境，所以说新建一个容器的时候，docker不需要像虚拟机一样重新加载一个操作系统内核，虚拟机是加载Guest OS 分钟级别，而docker是利用宿主机的操作系统，省略了这个复杂的过程 秒级")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}}),s._v(" "),a("th",{staticStyle:{"text-align":"center"}},[s._v("Docker容器")]),s._v(" "),a("th",{staticStyle:{"text-align":"center"}},[s._v("虚拟机（VM）")])])]),s._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("操作系统")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("与宿主机共享OS")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("宿主机OS上运行宿主机OS")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("存储大小")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("镜像小，便于存储与传输")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("镜像庞大（vmdk等）")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("运行性能")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("几乎无额外性能损失")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("操作系统额外的cpu、内存消耗")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("移植性")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("轻便、灵活、适用于Linux")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("笨重、与虚拟化技术耦合度高")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("硬件亲和性")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("面向软件开发者")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("面向硬件运维者")])])])])])]),s._v(" "),a("h2",{attrs:{id:"docker的常用命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker的常用命令"}},[s._v("#")]),s._v(" Docker的常用命令")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl status docker "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看docker运行状态")]),s._v("\nsystemctl start docker  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行docker")]),s._v("\nsystemctl stop docker   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭docker")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"帮助命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#帮助命令"}},[s._v("#")]),s._v(" 帮助命令")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("docker version     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示docker的版本信息")]),s._v("\ndocker info        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示docker的详细信息")]),s._v("\ndocker 命令 --help "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 帮助万能命令")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"镜像命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#镜像命令"}},[s._v("#")]),s._v(" 镜像命令")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("docker images")]),s._v("查看所有本地的主机上的镜像")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker images")]),s._v("\nREPOSITORY    TAG       IMAGE ID       CREATED        SIZE\nhello-world   latest    d1165f221234   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" months ago   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(".3kB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[a("p",[s._v("REPOSITORY：镜像的仓库源")])]),s._v(" "),a("li",[a("p",[s._v("TAG：镜像的标签")])]),s._v(" "),a("li",[a("p",[s._v("IMAGE ID：镜像的id")])]),s._v(" "),a("li",[a("p",[s._v("CREATED：镜像的创建时间")])]),s._v(" "),a("li",[a("p",[s._v("SIZE：镜像的大小")])]),s._v(" "),a("li",[a("p",[s._v("命令可选项")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("Options:\n      -a, --all             Show all images "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default hides intermediate images"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 列出所有镜像\n          --digests         Show digests\n      -q, --quiet           Only show image IDs 只显示镜像的id\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("docker search")]),s._v("搜索镜像")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker search mysql")]),s._v("\nNAME                              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED\nmysql                             MySQL is a widely used, open-source relation…   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10905")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("       \nmariadb                           MariaDB Server is a high performing "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" sou…   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4117")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("       \nmysql/mysql-server                Optimized MySQL Server Docker images. Create…   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("810")]),s._v("                  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ul",[a("li",[a("p",[s._v("命令可选项")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("Options:\n  -f, --filter filter   Filter output based on conditions provided\n      --format string   Pretty-print search using a Go template\n      --limit int       Max number of search results "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      --no-trunc        Don't truncate output\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过收藏来过滤")]),s._v("\ndocker search mysql -f"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("STARS"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 搜索STARS大于3000的镜像")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])])])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("docker pull 镜像名 [:tag]")]),s._v("下载镜像")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker pull mysql")]),s._v("\nUsing default tag: latest "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果不写tag，默认就是laterst")]),s._v("\nlatest: Pulling from library/mysql\n69692152171a: Pull complete "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 分层下载，docker images核心，联合文件系统")]),s._v("\n1651b0be3df3: Pull complete \n951da7386bc8: Pull complete \n0f86c95aa242: Pull complete \n37ba2d8bd4fF: Pull complete \n6d278bb05e94: Pull complete \n497efbd93a3F: Pull complete \nf7fddf10c2c2: Pull complete \n16415d159dfb: Pull complete \n0e530ffc6b73: Pull complete \nb0a4a1a77178: Pull complete \ncd90f92aa9ef: Pull complete \nDigest: sha256:d50098d7fcb25b1fcb24e2d3247cae3fc55815d64fec640dc395840f8fa80969 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 签名")]),s._v("\nStatus: Downloaded newer image "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" mysql:latest\ndocker.io/library/mysql:latest "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 真实地址")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker pull mysql 等价于 docker.io/library/mysql:latest")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定版本下载")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker pull mysql:5.7")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.7")]),s._v(": Pulling from library/mysql\n69692152171a: Already exists "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 联合文件系统，共用文件不需要重复下载")]),s._v("\n1651b0be3df3: Already exists \n951da7386bc8: Already exists \n0f86c95aa242: Already exists \n37ba2d8bd4fF: Already exists \n6d278bb05e94: Already exists \n497efbd93a3F: Already exists \na023ae82eef5: Pull complete \ne76c35f20ee7: Pull complete \ne887524d2ef9: Pull complete \nccb65627e1c3: Pull complete \nDigest: sha256:a682e3c78fc5bd941e9db080b4796c75f69a28a8cad65677c23f7a9f18ba21fa\nStatus: Downloaded newer image "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" mysql:5.7\ndocker.io/library/mysql:5.7\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("docker rmi -f 镜像id")]),s._v("删除镜像")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker rmi -f c0cdc95609f1")]),s._v("\nUntagged: mysql:latest\nUntagged: mysql@sha256:d50098d7fcb25b1fcb24e2d3247cae3fc55815d64fec640dc395840f8fa80969\nDeleted: sha256:c0cdc95609f1fc1daf2c7cae05ebd6adcf7b5c614b4f424949554a24012e3c09 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 共用的文件不会删除")]),s._v("\nDeleted: sha256:137bebc5ea278e61127e13cc7312fd83874cd19e392ee87252b532f0162fbd56\nDeleted: sha256:7ed0de2ad4e43c97f58fa9e81fba73700167ef9f8a9970685059e0109749a56b\nDeleted: sha256:9375660fbff871cd29c86b8643be60e376bfc96e99a3d7e8f93d74cd61500705\nDeleted: sha256:d8a47065d005ac34d81017677330ce096eb5562eeb971e2db12b0e200fdb1cb6\nDeleted: sha256:ca13c8ad9df5d824d5a259a927eaa6c04a60f022bc2abe8fc7866cf4b2b366f4\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("ul",[a("li",[s._v("删除所有镜像"),a("code",[s._v("docker rmi -f $(docker images -aq)")])]),s._v(" "),a("li",[s._v("删除多个镜像"),a("code",[s._v("docker rmi -f 镜像id 镜像id 镜像id")])])])])]),s._v(" "),a("h3",{attrs:{id:"容器命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#容器命令"}},[s._v("#")]),s._v(" 容器命令")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("说明：有了镜像才可以创建容器")])]),s._v(" "),a("li",[a("p",[s._v("下载一个centos镜像来测试学习"),a("code",[s._v("docker pull centos")])])]),s._v(" "),a("li",[a("p",[s._v("新建容器并启动"),a("code",[s._v("docker run [可选参数] image")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 参数说明")]),s._v("\n--name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器名字，用来区分，引号加不加无所谓")]),s._v("\n-d\t\t\t "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 后台方式运行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -t让docker分配一个伪终端并绑定到容器的标准输入上, -i则让容器的标准输入保持打开")]),s._v("\n-it\t\t\t "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用交互方式运行，进入容器查看内容")]),s._v("\n-p\t\t\t "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定容器端口 -p 8080:8080")]),s._v("\n\t-p 主机端口:容器端口"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("常用"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t-p ip:主机端口:容器端口\n\t-p 容器端口\n\t容器端口\n-P\t\t\t "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 随机指定端口")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])])])]),s._v(" "),a("h4",{attrs:{id:"启动测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动测试"}},[s._v("#")]),s._v(" 启动测试")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建并进入容器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker run -it centos /bin/bash")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看容器内的centos目录 (基础版本，很多命令都是不完善的)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@a58c3266d353 /"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\nbin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 退出容器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@a58c3266d353 /"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# exit")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出正在运行的容器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker ps")]),s._v("\nCONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出当前运行+曾经运行的容器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker ps -a")]),s._v("\nCONTAINER ID   IMAGE         COMMAND       CREATED         STATUS                     PORTS     NAMES\na58c3266d353   centos        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/bash"')]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" minutes ago   Exited "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" minutes ago             cool_mahavira\nd4b438b3af7e   hello-world   "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/hello"')]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" hours ago     Exited "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" hours ago               mystifying_chaplygin\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("ul",[a("li",[a("code",[s._v("docker run --name=别名 -p -d 2222:80 镜像名")]),s._v("以别名运行容器\n"),a("ul",[a("li",[s._v("--name：指定容器名称")]),s._v(" "),a("li",[s._v("-p：指定容器端口号 宿主机：容器")]),s._v(" "),a("li",[s._v("-d：指定容器后台运行")])])]),s._v(" "),a("li",[a("code",[s._v("docker ps")]),s._v("列出正在运行的容器")]),s._v(" "),a("li",[a("code",[s._v("docker ps -a")]),s._v("列出当前运行+曾经运行的容器")]),s._v(" "),a("li",[a("code",[s._v("docker ps -n=?")]),s._v("显示最近创建的?个容器，?为数字")]),s._v(" "),a("li",[a("code",[s._v("docker ps -q")]),s._v("只显示容器的编号")])]),s._v(" "),a("h4",{attrs:{id:"进入容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#进入容器"}},[s._v("#")]),s._v(" 进入容器")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("docker exec -it 容器id /bin/bash")]),s._v("进入容器，进入容器后开启一个新的终端 (常用)")]),s._v(" "),a("li",[a("code",[s._v("docker attach 容器id")]),s._v("进入容器，进入容器正在执行的终端，不会启动新的终端")])]),s._v(" "),a("h4",{attrs:{id:"退出容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#退出容器"}},[s._v("#")]),s._v(" 退出容器")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("exit")]),s._v("直接停止容器并退出")]),s._v(" "),a("li",[a("code",[s._v("Ctrl + P + Q")]),s._v("容器不停止退出(后台运行)")])]),s._v(" "),a("h4",{attrs:{id:"删除容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除容器"}},[s._v("#")]),s._v(" 删除容器")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("docker rm 容器id")]),s._v("删除指定容器，不能删除正在运行的容器，强制删除"),a("code",[s._v("rm -f")])]),s._v(" "),a("li",[a("code",[s._v("docker rm -f $(docker ps -aq)")]),s._v("删除所有容器")]),s._v(" "),a("li",[a("code",[s._v("docker ps -a -q|xargs docker rm")]),s._v("删除所有容器")])]),s._v(" "),a("h4",{attrs:{id:"启动和停止容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动和停止容器"}},[s._v("#")]),s._v(" 启动和停止容器")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("docker start 容器id")]),s._v("启动容器")]),s._v(" "),a("li",[a("code",[s._v("docker restart 容器id")]),s._v("重启容器")]),s._v(" "),a("li",[a("code",[s._v("docker stop 容器id")]),s._v("停止当前正在运行的容器")]),s._v(" "),a("li",[a("code",[s._v("docker kill 容器id")]),s._v("强制停止当前运行的容器")])]),s._v(" "),a("h4",{attrs:{id:"从容器中拷贝文件到主机上"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#从容器中拷贝文件到主机上"}},[s._v("#")]),s._v(" 从容器中拷贝文件到主机上")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("docker cp 容器id:容器内路径 目的主机路径")])]),s._v(" "),a("li",[s._v("拷贝是个手动过程，后面我们会使用 -v 卷的技术，可以实现自动同步，连通目录")])]),s._v(" "),a("h3",{attrs:{id:"常用其他命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用其他命令"}},[s._v("#")]),s._v(" 常用其他命令")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("docker stats")]),s._v("查看系统资源状态")]),s._v(" "),a("li",[a("code",[s._v("docker run -d 镜像名")]),s._v("后台启动容器\n"),a("ul",[a("li",[s._v("常见坑：容器使用后台运行，就必须要有一个前台进程，docker发现容器没有提供服务，就会自动停止")])])]),s._v(" "),a("li",[a("code",[s._v("docker logs -f -t --tail 日志条数")]),s._v("查看容器日志，不加--tail打印全部日志\n"),a("ul",[a("li",[s._v("-f：跟踪日志输出")]),s._v(" "),a("li",[s._v("-t：显示时间戳")])])]),s._v(" "),a("li",[a("code",[s._v("docker top 容器id")]),s._v("查看容器中的进程信息")]),s._v(" "),a("li",[a("code",[s._v("docker inspect 容器id/镜像名[:tag]")]),s._v("查看容器 / 镜像的元数据")])]),s._v(" "),a("h3",{attrs:{id:"小结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[s._v("#")]),s._v(" 小结")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Docker.assets/docker.png",alt:"2018071915491757"}})]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("attach\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当前she11 下attach连接指定运行镜像")]),s._v("\nbuild\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过Dockerfile定制镜像")]),s._v("\ncommit\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 提交当前容器为新的镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v("\t    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从容器中拷贝指定文件或者目录到宿主机中")]),s._v("\ncreate\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建一个新的容器，同run，但不启动容器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("diff")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看docker容器变化")]),s._v("\nevents  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从docker服务获取容器实时事件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在已存在的容器上运行命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导出容器的内容流作为一个 tar 归档文件[对应import]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("history")]),s._v("\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 展示一个镜像形成历史")]),s._v("\nimages\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出系统当前镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v("\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从tar包中的内容创建一个新的文件系统映像[对应export]")]),s._v("\ninfo\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示系统相关信息")]),s._v("\ninspect\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看容器详细信息")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v("\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kill指定docker容器")]),s._v("\nload\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从一个tar包中加载—卜镜像[对应save]")]),s._v("\nlogin\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注册或者登陆一个 docker 源服务器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("logout")]),s._v("\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从当前Docker registry退出")]),s._v("\nlogs\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出当前容器日志信息")]),s._v("\nport\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看映射端口对应的容器内部源端口")]),s._v("\npause\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 暂停容器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出容器列表")]),s._v("\npull\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从docker镜像源服务器拉取指定镜像或者库镜像")]),s._v("\npush\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 推送指定镜像或者库镜像至docker源服务器")]),s._v("\nrestart\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启运行的容器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v("\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 移除一个或者多个容器")]),s._v("\nrmi\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 移除一个或多个镜像[无容器使用该镜像才可删除，否则需删除相关容器才可继续或 -f 强制删除]")]),s._v("\nrun\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建一个新的容器并运行一个命令")]),s._v("\nsave\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 保存一个镜像为一个 tar 包[对应load]")]),s._v("\nsearch\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在docker hub中搜索镜像")]),s._v("\nstart\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动容器")]),s._v("\nstop\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止容器")]),s._v("\ntag\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 给源中镜像打标签")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看容器中运行的进程信息.")]),s._v("\nunpause\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 取消暂停容器")]),s._v("\nversion\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看docker版本号")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wait")]),s._v("\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 截取容器停止时的退出状态值")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br")])]),a("h2",{attrs:{id:"docker部署环境练习"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker部署环境练习"}},[s._v("#")]),s._v(" Docker部署环境练习")]),s._v(" "),a("h3",{attrs:{id:"部署nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署nginx"}},[s._v("#")]),s._v(" 部署Nginx")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("搜索镜像")])]),s._v(" "),a("li",[a("p",[s._v("下载镜像")])]),s._v(" "),a("li",[a("p",[s._v("开启镜像")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker images")]),s._v("\nREPOSITORY    TAG       IMAGE ID       CREATED        SIZE\nnginx         latest    f0b8a9a54136   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" days ago    133MB\nmysql         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.7")]),s._v("       2c9028880e58   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" days ago    447MB\nhello-world   latest    d1165f221234   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" months ago   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(".3kB\ncentos        latest    300e315adb2f   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" months ago   209MB\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -d：后台运行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --name：给容器命名")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -p 暴露端口，端口映射(宿主机端口:容器内端口)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker run -d --name nginx01 -p 80:80 nginx")]),s._v("\n7070c6b0545da33a307a5a515fbf04195a817a4c584d6ebc3a267b2155304b92\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker ps")]),s._v("\nCONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS                               NAMES\n7070c6b0545d   nginx     "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/docker-entrypoint.…"')]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" seconds ago   Up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" seconds   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:80-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp, :::80-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp   nginx01\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 宿主机尝试访问容器内nginx")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl localhost:80")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("进入容器内一探究竟")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以bash终端进入容器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker exec -it nginx01 /bin/bash")]),s._v("\nroot@7070c6b0545d:/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# whereis nginx")]),s._v("\nnginx: /usr/sbin/nginx /usr/lib/nginx /etc/nginx /usr/share/nginx\nroot@7070c6b0545d:/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /etc/nginx")]),s._v("\nroot@7070c6b0545d:/etc/nginx"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\nconf.d\tfastcgi_params\tkoi-utf  koi-win  mime.types  modules  nginx.conf  scgi_params\tuwsgi_params  win-utf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看nginx配置文件")]),s._v("\nroot@7070c6b0545d:/etc/nginx"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat nginx.conf")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])])])]),s._v(" "),a("ul",[a("li",[s._v("问题：我们每次改动nginx配置，都得进入容器内部修改，十分麻烦，如果可以在容器外部提供一个映射路径，在容器外部修改配置文件，容器内部能同步自动修改，岂不美哉？-v 数据卷")])]),s._v(" "),a("h3",{attrs:{id:"部署tomcat"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署tomcat"}},[s._v("#")]),s._v(" 部署Tomcat")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 官方的使用")]),s._v("\ndocker run -it --rm tomcat:9.0\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 我们之前的启动都是后台，停止了容器之后，容器不会被删除，官方的这种用法一般用于测试，用完就删除")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动后Ctrl + C退出")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 我们自己测试")]),s._v("\ndocker pull tomcat\ndocker run -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":8080 --name tomcat01 tomcat\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试访问 http://ip地址:8080/没问题，只是404，因为镜像是阉割版的tomcat")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入容器")]),s._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it tomcat01 /bin/bash\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发现问题：1. linux命令少了 2.webapps目录为空。阿里云镜像的原因，默认最小镜像，所有不必要的都剔除了，只保证最小可运行环境")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 但又发现有一个webapps.dist目录，进入后发现原本在webapps目录下的文件都存在里面")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 于是我们试着把该目录下的所有文件复制到webapps目录下")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -r webapps.dist/* webapps "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -r：若给出的源文件是一个目录文件，此时将复制该目录下所有的子目录和文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新访问tomcat，发现有初始页了")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("ul",[a("li",[s._v("问题：我们以后要部署项目，每次都要进入容器是不是很麻烦，如果可以在容器外部提供一个映射路径，比如webapps，我们在外部放置项目，就自动同步到内部就好了")])]),s._v(" "),a("h3",{attrs:{id:"部署elasticsearch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署elasticsearch"}},[s._v("#")]),s._v(" 部署elasticsearch")]),s._v(" "),a("ul",[a("li",[s._v("由于es暴露的端口多，十分耗内存等特点")]),s._v(" "),a("li",[s._v("增加内存的限制，修改配置文件 -e 环境配置修改")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("docker run -d --name es -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v(":9200 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9300")]),s._v(":9300 -e "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"discovery.type=single-node"')]),s._v(" -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ES_JAVA_OPTS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Xms64m -Xmx512m"')]),s._v(" elasticsearch:7.6.2\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"可视化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#可视化"}},[s._v("#")]),s._v(" 可视化")]),s._v(" "),a("ul",[a("li",[s._v("portainer(先用这个)")]),s._v(" "),a("li",[s._v("Rancher(CI/CD再用)")])]),s._v(" "),a("h3",{attrs:{id:"什么是protainer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是protainer"}},[s._v("#")]),s._v(" 什么是protainer")]),s._v(" "),a("ul",[a("li",[s._v("Docker图形化界面管理工具，提供一个后台面板供我们操作")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("docker run -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8088")]),s._v(":9000 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--restart"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always -v /var/run/docker.sock:/var/run/docker.sock --privileged"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true portainer/portainer\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[s._v("访问测试："),a("code",[s._v("http://ip地址:8088/")])])]),s._v(" "),a("h2",{attrs:{id:"docker镜像讲解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker镜像讲解"}},[s._v("#")]),s._v(" Docker镜像讲解")]),s._v(" "),a("h3",{attrs:{id:"镜像是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#镜像是什么"}},[s._v("#")]),s._v(" 镜像是什么")]),s._v(" "),a("ul",[a("li",[s._v("镜像是一种轻量级、可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含运行某个软件所需的所有内容，包括代码、运行时、库、环境变量和配置文件")]),s._v(" "),a("li",[s._v("所有的应用，直接打包成docker镜像，就可以直接部署")]),s._v(" "),a("li",[s._v("如何得到镜像：\n"),a("ul",[a("li",[s._v("从远程仓库下载")]),s._v(" "),a("li",[s._v("朋友拷贝")]),s._v(" "),a("li",[s._v("自己制作 DockerFile")])])])]),s._v(" "),a("h3",{attrs:{id:"docker镜像加载原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker镜像加载原理"}},[s._v("#")]),s._v(" Docker镜像加载原理")]),s._v(" "),a("h4",{attrs:{id:"unionfs-联合文件系统"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#unionfs-联合文件系统"}},[s._v("#")]),s._v(" UnionFS (联合文件系统)")]),s._v(" "),a("ul",[a("li",[s._v("UnionFS("),a("strong",[s._v("联合文件系统")]),s._v(")：Union文件系统(UnionFS)是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下(unite several directories into a single virtualfilesystem)。Union文件系统是Docker镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像")]),s._v(" "),a("li",[s._v("特性：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录")])]),s._v(" "),a("h4",{attrs:{id:"docker镜像加载原理-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker镜像加载原理-2"}},[s._v("#")]),s._v(" Docker镜像加载原理")]),s._v(" "),a("ul",[a("li",[s._v("docker的镜像实际上由一层一层的文件系统组成，这种层级的文件系统UnionFS")]),s._v(" "),a("li",[s._v("bootfs(boot file system)主要包含bootloader和kernel，bootloader主要是引导加载kernel，Linux刚启动时会加载bootfs文件系统，在Docker镜像的最底层是bootfs。这一层与我们典型的Linux/Unix系统是一样的，包含boot加载器和内核。当boot加载完成之后整个内核就都在内存中了，此时内存的使用权已由bootfs转交给内核，此时系统也会卸载bootfs")]),s._v(" "),a("li",[s._v("rootfs (root file system)，在bootfs之上。包含的就是典型Linux系统中的/dev，/proc，/bin，/letc等标准目录和文件。roots就是各种不同的操作系统发行版，比如Ubuntu，Centos等等")])]),s._v(" "),a("h3",{attrs:{id:"分层理解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分层理解"}},[s._v("#")]),s._v(" 分层理解")]),s._v(" "),a("ul",[a("li",[s._v("思考︰为什么Docker镜像要采用这种分层的结构呢？\n"),a("ul",[a("li",[s._v("最大的好处，我觉得莫过于是资源共享了。比如有多个镜像都从相同的Base镜像构建而来，那么宿主机只需在磁盘上保留一份base镜像，同时内存中也只需要加载一份base镜像，这样就可以为所有的容器服务了，而且镜像的每一层都可以被共享")])])]),s._v(" "),a("li",[s._v("理解：\n"),a("ul",[a("li",[s._v("所有的Docker镜像都起始于一个基础镜像层，当进行修改或增加新的内容时，就会在当前镜像层之上，创建新的镜像层")]),s._v(" "),a("li",[s._v("举一个简单的例子，假如基于Ubuntu Linux 16.04创建一个新的镜像，这就是新镜像的第一层。如果在该镜像中添加 Python包，就会在基础镜像层之上创建第二个镜像层。如果继续添加一个安全补丁，就会创建第三个镜像层，该镜像当前已经包含3个镜像层")])])]),s._v(" "),a("li",[s._v("特点：\n"),a("ul",[a("li",[s._v("Docker镜像都是只读的，当容器启动时，一个新的可写层被加载到镜像的顶部。这一层就是我们通常说的容器层，容器之下的都叫镜像层")])])])]),s._v(" "),a("h3",{attrs:{id:"commit镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#commit镜像"}},[s._v("#")]),s._v(" commit镜像")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("docker commit")]),s._v("提交容器成为一个新的副本")]),s._v(" "),a("ul",[a("li",[a("code",[s._v('docker commit -m="提交的描述信息" -a="作者" 容器id(名字也行) 目标镜像名[:tag]')])])])]),s._v(" "),a("li",[a("p",[s._v("实战测试")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动一个默认的tomcat")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发现这个默认的tomcat没有webapps应用，于是我自己拷贝了基本文件进去")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后将修改后的容器提交为一个新的镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# docker commit -a="lzj" -m="add webapps app" tomcat1 tomcat2:1.0')]),s._v("\nsha256:2f043e053396abb2ed4ec7cc94ad00a5c86a8a954c227ed9ae7de65bb9a849ec\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker images")]),s._v("\nREPOSITORY            TAG       IMAGE ID       CREATED          SIZE\ntomcat2               "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("       2f043e053396   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" seconds ago   672MB\ntomcat                latest    c43a65faae57   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" days ago      667MB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])])])]),s._v(" "),a("h2",{attrs:{id:"容器数据卷"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#容器数据卷"}},[s._v("#")]),s._v(" 容器数据卷")]),s._v(" "),a("h3",{attrs:{id:"什么是容器数据卷"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是容器数据卷"}},[s._v("#")]),s._v(" 什么是容器数据卷")]),s._v(" "),a("ul",[a("li",[s._v("docker的理念回顾：将应用和环境打包成一个镜像")]),s._v(" "),a("li",[s._v("问题：如果数据都在容器中，那么容器一删除，数据就会丢失，这不是我们希望看到的\n"),a("ul",[a("li",[s._v("需求：数据可以存在本地，而不是容器。mysql：目前删容器=删库")]),s._v(" "),a("li",[s._v("容器之间可以有一个数据共享的技术，docker容器中产生的数据，同步到本地，这就是卷技术")]),s._v(" "),a("li",[s._v("卷技术：目录的挂载，将容器内的目录挂载到linux本机上")])])])]),s._v(" "),a("h3",{attrs:{id:"使用数据卷"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用数据卷"}},[s._v("#")]),s._v(" 使用数据卷")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("使用命令来挂载"),a("code",[s._v("docker run -it -v 主机目录:容器目录")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker inspect b2a2f3fa0956 查看容器详细信息")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mounts"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 挂载")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Type"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bind"')]),s._v(",\n\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Source"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/home/ceshi"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主机内")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Destination"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/home"')]),s._v(",  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器内")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mode"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"RW"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Propagation"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rprivate"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("ul",[a("li",[s._v("好处：挂载后修改文件只需要在本地修改即可，删掉容器数据也不会丢失")])])])]),s._v(" "),a("h4",{attrs:{id:"实战-安装mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实战-安装mysql"}},[s._v("#")]),s._v(" 实战：安装Mysql")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取镜像")]),s._v("\ndocker pull mysql:5.7\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行容器，运行的时候记得做数据挂载")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装启动mysql，需要配置密码，注意")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 官方测试：docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动我们的 -d 后台运行 -p 端口映射 -v 数据卷挂载")]),s._v("\ndocker run -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3310")]),s._v(":3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" --name mysql01 mysql:5.7\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动成功后，使用sqlyog来测试是否能成功连接")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 成功连接后再测试创建一个数据库，查看服务器本地/home/mysql/data中是否有新文件")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h4",{attrs:{id:"具名挂载和匿名挂载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#具名挂载和匿名挂载"}},[s._v("#")]),s._v(" 具名挂载和匿名挂载")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("共同点：都不指定主机目录，只设置了容器挂载目录")])]),s._v(" "),a("li",[a("p",[s._v("匿名挂载：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("-v 容器内路径")]),s._v("："),a("code",[s._v("docker run -d -P --name nginx01 -v /etc/nginx nginx")])]),s._v(" "),a("li",[s._v("-v只写容器内路径，没有写容器外路径，就叫匿名挂载")])])]),s._v(" "),a("li",[a("p",[s._v("具名挂载：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("-v 卷名:容器内路径")])]),s._v(" "),a("li",[s._v("查看一下这个卷"),a("code",[s._v("docker volume inspect 卷名")])]),s._v(" "),a("li",[s._v("所有的docker容器内的卷，没有指定主机目录的情况下，都是在"),a("code",[s._v("/var/lib/docker/volumes/xxx/_data")])]),s._v(" "),a("li",[s._v("通过具名挂载可以方便的找到卷和挂载路径")])])]),s._v(" "),a("li",[a("p",[s._v("如何确定是具名挂载还是匿名挂载，还是指定路径挂载")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("-v 容器内路径")]),s._v(" 匿名挂载")]),s._v(" "),a("li",[a("code",[s._v("-v 卷名:容器内路径")]),s._v(" 具名挂载")]),s._v(" "),a("li",[a("code",[s._v("-v 主机路径:容器内路径")]),s._v(' 指定路径挂载 (路径开头记得加"/")')])])]),s._v(" "),a("li",[a("p",[s._v("拓展：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("docker run -d -P --name nginx02 -v nginx02:/etc/nginx:ro nginx")]),s._v("，"),a("code",[s._v(":ro")]),s._v("或者"),a("code",[s._v(":rw")]),s._v("的意思")]),s._v(" "),a("li",[s._v("通过"),a("code",[s._v("-v 容器内路径:ro rw")]),s._v("可以改变读写权限\n"),a("ul",[a("li",[s._v("ro：readOnly 只读，"),a("strong",[s._v("只能通过主机操作修改")]),s._v("，容器内部无法操作")]),s._v(" "),a("li",[s._v("rw：readWrite 可读写")])])])])])]),s._v(" "),a("h3",{attrs:{id:"数据卷容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据卷容器"}},[s._v("#")]),s._v(" 数据卷容器")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("两个mysql同步数据")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Docker.assets/image-20210526144952202.png",alt:"image-20210526144952202"}})])]),s._v(" "),a("li",[a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动3个容器，通过我们自己写镜像启动")]),s._v("\ndocker run -it --name centos01 test/centos\ndocker run -it --name centos02 --volumes-from centos01 test/centos "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 与centos01容器挂载的目录同步")]),s._v("\ndocker run -it --name centos03 --volumes-from centos01 test/centos "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同上")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把容器1删了，会发现容器2,3的文件还在，并且，2,3的文件依然同步着。说明最终还是引用了主机的地址，而--volumes-from centos01只是把容器1的引用传过来了")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("多个mysql实现数据共享")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("docker run -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3310")]),s._v(":3306 -v /etc/mysql/conf.d -v /var/lib/mysql -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" --name mysql01 mysql:5.7\ndocker run -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3311")]),s._v(":3306 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" --volumes-from mysql01 --name mysql01 mysql:5.7\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("结论：")]),s._v(" "),a("ul",[a("li",[s._v("容器之间配置信息的传递，数据卷容器的生命周期一直持续到没有容器使用为止")])])])]),s._v(" "),a("h2",{attrs:{id:"dockerfile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile"}},[s._v("#")]),s._v(" DockerFile")]),s._v(" "),a("ul",[a("li",[s._v("DockerFile就是用来构建docker镜像的构建文件 (命令脚本)，通过这个脚本可以生成镜像")]),s._v(" "),a("li",[s._v("镜像是一层一层的，脚本是一个一个的命令，每个命令就代表一层")]),s._v(" "),a("li",[s._v("构建步骤：\n"),a("ol",[a("li",[s._v("编写一个dockerfile文件")]),s._v(" "),a("li",[s._v("docker build构建成一个镜像")]),s._v(" "),a("li",[s._v("docker run运行镜像")]),s._v(" "),a("li",[s._v("docker push发布镜像 (DockerHub、阿里云镜像仓库)")])])])]),s._v(" "),a("h3",{attrs:{id:"体验dockerfile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#体验dockerfile"}},[s._v("#")]),s._v(" 体验DockerFile")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建一个dockerfile文件，名字随意，建议Dockerfile")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 文件中的内容 指令 参数")]),s._v("\nFROM centos\nVOLUME "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"volume01"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"volume02"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nCMD "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"----end----"')]),s._v("\nCMD /bin/bash\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行 -f 要运行的文件 -t 镜像的名字 . 镜像生成的路径(当前路径)")]),s._v("\ndocker build -f dockerfile1 -t test/centos "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里的每个命令就是镜像的一层")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动镜像，ls -l查看文件会发现生成了命令中设置的挂载的数据卷目录")]),s._v("\ndrwxr-xr-x.   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" May "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(" 06:27 volume01\ndrwxr-xr-x.   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" May "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(" 06:27 volume02\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h3",{attrs:{id:"dockerfile构建过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile构建过程"}},[s._v("#")]),s._v(" DockerFile构建过程")]),s._v(" "),a("ul",[a("li",[s._v("基础知识：\n"),a("ol",[a("li",[s._v("每个保留关键字(指令)都必须是大写字母")]),s._v(" "),a("li",[s._v("从上到下顺序执行")]),s._v(" "),a("li",[s._v("#表示注释")]),s._v(" "),a("li",[s._v("每个指令都会创建提交一个新的镜像层，并提交")])])]),s._v(" "),a("li",[s._v("dockerfile是面向开发的，我们以后要发布项目要做镜像，就需要编写dockerfile文件，编写这个文件不难")]),s._v(" "),a("li",[s._v("docker镜像逐渐成为企业交付的标准")]),s._v(" "),a("li",[s._v("步骤：开发->部署->运维\n"),a("ul",[a("li",[s._v("DockerFile：构建文件，定义了一切的步骤，源代码")]),s._v(" "),a("li",[s._v("DockerImages：通过DockerFile构建生成的镜像，最终发布和运行的产品")]),s._v(" "),a("li",[s._v("Docker容器：容器就是镜像运行起来提供服务")])])])]),s._v(" "),a("h3",{attrs:{id:"dockerfile的指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile的指令"}},[s._v("#")]),s._v(" DockerFile的指令")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Docker.assets/image-20210821212210700.png",alt:"image-20210821212210700"}})]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("FROM\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 基础镜镜像，一切从这里开始构建 比如centos")]),s._v("\nMAINTAINER\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 镜像是谁写的，姓名+邮箱")]),s._v("\nRUN\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 镜像构建的时候需要运行的命令")]),s._v("\nADD\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 步骤：tomcat镜像，这个tomcat压缩包就是添加的内容")]),s._v("\nWORKDIR\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 镜像的工作目录")]),s._v("\nVOLUME\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 挂载的目录")]),s._v("\nEXPOSE\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定暴露端口")]),s._v("\nCMD\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定这个容器启动的时候要运行的命令 一个Dockerfile仅仅最后一个CMD起作用 可被替代")]),s._v("\nENTRYPOINT\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定这个容器启动的时候要运行的命令 可以追加命令")]),s._v("\n指定命令ls -a\tdocker run -l，CMD指定会被替换，而ENTRYPOINT则是追加ls -a -l\nONBUILD\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 该指令对利用该DockerFile构建镜像（比如为A镜像）不会产生实质性影响，但是当我们编写一个新的DockerFile文件来基于A镜像构建一个镜像（比如为B镜像）时，这时构造A镜像的DockerFile文件中的ONBUILD指令就生效了，在构建B镜像的过程中，首先会执行ONBUILD指令指定的指令，然后才会执行其它指令")]),s._v("\nCOPY\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 类似ADD，将我们的文件拷贝到镜像中 (不会自动解压)")]),s._v("\nENV\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建的时候设置环境变量")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h3",{attrs:{id:"实战测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实战测试"}},[s._v("#")]),s._v(" 实战测试")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Docker Hub中99%的镜像都是从这个基础镜像过来的 FROM scratch，然后配置需要的软件和配置来进行构建")])]),s._v(" "),a("li",[a("p",[s._v("创建一个自己的centos")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编写dockerfile文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" mydockerfile-centos\n\nFROM centos\nMAINTAINER test"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("test@qq.com"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nENV MYPATH /usr/local\nWORKDIR "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MYPATH")]),s._v("\nRUN yum -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v("\nRUN yum -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" net-tools\nEXPOSE "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\nCMD /bin/bash\n\ndocker build -f mydockerfiler-centos -t mycentos:0.1 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("docker history 镜像")]),s._v("可以查看镜像的构建过程")])])]),s._v(" "),a("h3",{attrs:{id:"cmd-和-entrypoint的区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cmd-和-entrypoint的区别"}},[s._v("#")]),s._v(" CMD 和 ENTRYPOINT的区别")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("测试CMD")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("FROM centos\nCMD "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ls"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-a"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建镜像")]),s._v("\ndocker build -f dockerfile-cmd-test -t cmdtest "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# run运行")]),s._v("\ndocker run 镜像\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -a 生效\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 但如果")]),s._v("\ndocker run 镜像 -l "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 追加-l，理想情况下我们要 ls -al，但报错了，因为CMD情况下-l替换了["ls","-a"]，而-l不是命令，所以报错')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 而ENTRYPOINT就不是覆盖而且追加")]),s._v("\ndocker run 镜像 -l "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 就会等价于ls -al")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])])])]),s._v(" "),a("h3",{attrs:{id:"实战-tomcat镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实战-tomcat镜像"}},[s._v("#")]),s._v(" 实战：Tomcat镜像")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("准备镜像文件：tomcat压缩包，jdk压缩包")])]),s._v(" "),a("li",[a("p",[s._v("编写dockerfile文件，官方命名Dockerfile，用该名字执行的时候就不用-f了")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("FROM centos\nMAINTAINER test"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v("@qq.com"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\nCOPY readme.txt /usr/local/readme.txt\nADD jdk-8u161-linux-x64.tar.gz /usr/local/\nADD apache-tomcat-9.0.46.tar.gz /usr/local/\n\nRUN yum -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v("\n\nENV MYPATH /usr/local\nWORKDIR "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MYPATH")]),s._v("\n\nENV JAVA_HOME /usr/local/jdk1.8.0_161\nENV CLASSPATH "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAVA_HOME")]),s._v("/lib/dt.jar:"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAVA_HOME")]),s._v("/lib/tools.jar\nENV CATALINA_HOME /usr/local/apache-tomcat-9.0.46\nENV CATALINA_BASE /usr/local/apache-tomcat-9.0.46\nENV "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAVA_HOME")]),s._v("/bin:"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CATALINA_HOME")]),s._v("/lib:"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CATALINA_HOME")]),s._v("/bin\n\nEXPOSE "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n\nCMD /usr/local/apache-tomcat-9.0.46/bin/startup.sh "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -F /usr/local/apache-tomcat-9.0.46/bin/logs/catalina.out\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("构建镜像："),a("code",[s._v("docker build -t diytomcat .")])])]),s._v(" "),a("li",[a("p",[s._v("启动我们构建的镜像生成容器："),a("code",[s._v("docker run -d -p 8080:8080 --name testtomcat -v /home/build/tomcat/test:/usr/local/apache-tomcat-9.0.46/webapps/test -v /home/build/tomcat/tomcatlogs/:/usr/local/apache-tomcat-9.0.46/logs diytomcat")])])]),s._v(" "),a("li",[a("p",[s._v("访问8080端口查看是否成功")])]),s._v(" "),a("li",[a("p",[s._v("测试挂载目录是否成功")])]),s._v(" "),a("li",[a("p",[s._v("发布项目 (由于做了卷挂载，我们直接在本地编写项目就可以发布了)")])]),s._v(" "),a("li",[a("p",[s._v("测试发布是否成功")])])]),s._v(" "),a("ul",[a("li",[s._v("我们以后开发的步骤：需要掌握Dockerfile的编写，我们之后的一切都是使用docker镜像来发布运行")])]),s._v(" "),a("h3",{attrs:{id:"把多个镜像合并思路"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#把多个镜像合并思路"}},[s._v("#")]),s._v(" 把多个镜像合并思路")]),s._v(" "),a("ul",[a("li",[s._v("通过使用"),a("code",[s._v("docker history 镜像")]),s._v("查看构建镜像时的Dockerfile命令")]),s._v(" "),a("li",[s._v("然后整合到一个Dockerfile文件中build")])]),s._v(" "),a("h3",{attrs:{id:"发布自己的镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#发布自己的镜像"}},[s._v("#")]),s._v(" 发布自己的镜像")]),s._v(" "),a("h4",{attrs:{id:"dockerhub"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerhub"}},[s._v("#")]),s._v(" DockerHub")]),s._v(" "),a("ol",[a("li",[s._v("注册账号并确定能成功登录")]),s._v(" "),a("li",[a("code",[s._v("docker login -u 用户名 也可以加上-p 密码")]),s._v("登录DockerHub")]),s._v(" "),a("li",[a("code",[s._v("docker pull 作者名/镜像[:tag]")]),s._v("提交镜像，最好带版本号")])]),s._v(" "),a("h4",{attrs:{id:"阿里云"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#阿里云"}},[s._v("#")]),s._v(" 阿里云")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("登录阿里云")])]),s._v(" "),a("li",[a("p",[s._v("找到容器镜像服务")])]),s._v(" "),a("li",[a("p",[s._v("创建命名空间")])]),s._v(" "),a("li",[a("p",[s._v("创建容器镜像")])]),s._v(" "),a("li",[a("p",[s._v("浏览阿里云镜像服务")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Docker.assets/image-20210527193417943.png",alt:"image-20210527193417943"}})])])]),s._v(" "),a("h3",{attrs:{id:"小结-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小结-2"}},[s._v("#")]),s._v(" 小结")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Docker.assets/image-20210527194831179.png",alt:"image-20210527194831179"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"Docker.assets/docker.png",alt:"docker"}})]),s._v(" "),a("h2",{attrs:{id:"docker网络"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker网络"}},[s._v("#")]),s._v(" Docker网络")]),s._v(" "),a("h3",{attrs:{id:"理解docker0"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#理解docker0"}},[s._v("#")]),s._v(" 理解Docker0")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("三个网络")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Docker.assets/image-20210527221232819.png",alt:"image-20210527221232819"}})])]),s._v(" "),a("li",[a("p",[s._v("问题：docker是如何处理容器网络访问的？")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker run -d -P --name tomcat01 tomcat")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看容器的内部网络地址 ip addr，发现容器启动的时候会得到一个 eth0@if5 ip地址，是由docker分配的")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker exec -it tomcat01 ip addr")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(": lo: "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("LOOPBACK,UP,LOWER_UP"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v(" qdisc noqueue state UNKNOWN group default qlen "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1/8 scope "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" lo\n       valid_lft forever preferred_lft forever\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(": eth0@if5: "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("BROADCAST,MULTICAST,UP,LOWER_UP"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v(" qdisc noqueue state UP group default \n    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n    inet "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.2/16 brd "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".255.255 scope global eth0\n       valid_lft forever preferred_lft forever\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用ping命令去ping容器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发现可以ping通容器内部")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("原理：")]),s._v(" "),a("ul",[a("li",[s._v("我们每启动一个docker容器，docker就会给容器分配一个ip，我们只要安装了docker，就会有一个网卡docker0")]),s._v(" "),a("li",[s._v("使用桥接模式，veth-pair技术")])])]),s._v(" "),a("li",[a("p",[s._v("再次执行"),a("code",[s._v("ip addr")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发现又多了个网络")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(": veth63b91e5@if4: "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("BROADCAST,MULTICAST,UP,LOWER_UP"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v(" qdisc noqueue master docker0 state UP group default \n    link/ether 02:51:98:19:92:7c brd ff:ff:ff:ff:ff:ff link-netnsid "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n    inet6 fe80::51:98ff:fe19:927c/64 scope "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" \n       valid_lft forever preferred_lft forever\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("再启动一个容器试试")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发现又多了一个网络")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(": veth3223042@if6: "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("BROADCAST,MULTICAST,UP,LOWER_UP"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v(" qdisc noqueue master docker0 state UP group default \n    link/ether 7F:af:81:93:10:86 brd ff:ff:ff:ff:ff:ff link-netnsid "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    inet6 fe80::7caf:81ff:fe93:1086/64 scope "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" \n       valid_lft forever preferred_lft forever\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("进入启动的容器查看"),a("code",[s._v("ip addr")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发现容器里的网络与容器外的网络是对应关系")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(": eth0@if7: "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("BROADCAST,MULTICAST,UP,LOWER_UP"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v(" qdisc noqueue state UP group default \n    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff link-netnsid "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n    inet "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.3/16 brd "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".255.255 scope global eth0\n       valid_lft forever preferred_lft forever\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("我们发现这个容器带来的网络，都是一对一对出现的")])]),s._v(" "),a("li",[a("p",[s._v("veth-pair就是一对虚拟设备接口，它们都是成对出现的，一端连着协议，一端彼此相连")])]),s._v(" "),a("li",[a("p",[s._v("正因为有这个特性，通常用veth-pair充当一个桥梁")])]),s._v(" "),a("li",[a("p",[s._v("结论：tomcat01和tomcat02共用同一个docker0")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Docker.assets/image-20210528102907824.png",alt:"image-20210528102907824"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/Docker.assets/image-20210528103629201.png",alt:"image-20210528103629201"}})]),s._v(" "),a("ul",[a("li",[s._v("所有容器不指定网络的情况下，都是由docker0路由的，docker会给我们的容器分配一个默认可用的ip")]),s._v(" "),a("li",[s._v("docker中的所有网络接口都是虚拟的，虚拟的转发效率高")])])])]),s._v(" "),a("h3",{attrs:{id:"link"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#link"}},[s._v("#")]),s._v(" --link")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("思考：我们编写了一个微服务，database url=ip，当我们数据库ip换了，我们希望可以通过名字来访问容器")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启两个tomcat容器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker ps")]),s._v("\nCONTAINER ID   IMAGE     COMMAND             CREATED        STATUS          PORTS                                         NAMES\n656895ea2faa   tomcat    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"catalina.sh run"')]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" hours ago   Up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" seconds    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:49156-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("/tcp, :::49156-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("/tcp   tomcat02\n125a4408894a   tomcat    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"catalina.sh run"')]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" hours ago   Up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" seconds   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:49155-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("/tcp, :::49155-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("/tcp   tomcat01\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发现正常情况下使用容器名ping不通")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker exec -it tomcat01 ping tomcat02")]),s._v("\nping: tomcat02: Name or "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" not known\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过--link绑定两个容器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker run -d -P --name tomcat03 --link tomcat01 tomcat")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发现tomcat01 ping tomcat03依然无法ping通")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker exec -it tomcat01 ping tomcat03")]),s._v("\nping: tomcat03: Name or "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" not known\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 但tomcat03 ping tomcat01成功ping通，说明--link是单向连接")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker exec -it tomcat03 ping tomcat01")]),s._v("\nPING tomcat01 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("84")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" bytes of data.\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from tomcat01 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.107")]),s._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from tomcat01 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.059")]),s._v(" ms\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("--link本质：修改目标容器中对应的环境变量并在hosts配置中增加了一个域名解析配置")])]),s._v(" "),a("li",[a("p",[s._v("不建议使用--link，得使用自定义网络")])])]),s._v(" "),a("h3",{attrs:{id:"自定义网络"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自定义网络"}},[s._v("#")]),s._v(" 自定义网络")]),s._v(" "),a("ul",[a("li",[s._v("docker0问题：它不支持容器名连接访问")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用docker network ls可以显示所有docker网络，docker network rm 网卡 可以移除网卡")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker network ls")]),s._v("\nNETWORK ID     NAME      DRIVER    SCOPE\nbd4c48741e22   bridge    bridge    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\n98aff4d650d3   "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\nca1053037707   none      null      "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("ul",[a("li",[a("p",[s._v("docker网络模式：")]),s._v(" "),a("ol",[a("li",[s._v("bridge：桥接 (默认，自定义也是用该模式) ，docker0作为桥，使容器可以通过docker0访问其他容器")]),s._v(" "),a("li",[s._v("none：不配置网络")]),s._v(" "),a("li",[s._v("host：和宿主机共享网络")]),s._v(" "),a("li",[s._v("container：容器内网络连通(用的少，局限大)")])])]),s._v(" "),a("li",[a("p",[s._v("测试")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不加--net bridge启动实际上等价于加上，是默认的，与docker0进行连接")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker run -d -P --name tomcat01 tomcat")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker run -d -P --name tomcat01 --net bridge tomcat")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker0特点：默认，域名不能访问，--link可以打通连接")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 我们可以自定义一个网络")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --driver bridge桥接，默认")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --subnet 192.168.0.0/16子网地址及掩码")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --gateway 192.168.0.1网关")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet")]),s._v("\nf68430d33cfd675af7019697121b362590712be6e997429d5bf372f52fe86b0c\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker network ls")]),s._v("\nNETWORK ID     NAME      DRIVER    SCOPE\nbd4c48741e22   bridge    bridge    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\n98aff4d650d3   "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\nf68430d33cfd   mynet     bridge    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\nca1053037707   none      null      "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看我们直接创建的网络的详细信息")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker network inspect mynet")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mynet"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Id"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"f68430d33cfd675af7019697121b362590712be6e997429d5bf372f52fe86b0c"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Created"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2021-05-28T11:38:34.147661299+08:00"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Scope"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"local"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Driver"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bridge"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EnableIPv6"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPAM"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Driver"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),s._v(",\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Options"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Config"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Subnet"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.0.0/16"')]),s._v(",\n                    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Gateway"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.0.1"')]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Internal"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Attachable"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Ingress"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ConfigFrom"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Network"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ConfigOnly"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Containers"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Options"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Labels"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用我们自己创建的网络开启容器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker run -d -P --name tomcat-net-01 --net mynet")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker run -d -P --name tomcat-net-02 --net mynet")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 再次查看我们建的网络的详细信息")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker network inspect mynet")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Containers"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"32912e299359258c800d0b9f930a68ecbbc3b1dac679ee7612eaad8ded03f3f1"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tomcat-net-02"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EndpointID"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bc2af3cd59c6c3268572399313a297bec03ae837efee9c5dbab0ab73fe7dfe03"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MacAddress"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"02:42:c0:a8:00:03"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPv4Address"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.0.3/16"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPv6Address"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"4c4523ae06e60e44480c7b7d1069abf04e5bd366a685602abae0a8ef1d5d78a8"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tomcat-net-01"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EndpointID"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"857853bfa8f07f473b400d94b41533abbb827bb30f26d210f84d55200a2ca978"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MacAddress"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"02:42:c0:a8:00:02"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPv4Address"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.0.2/16"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPv6Address"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发现Containers中已经存在了刚刚启动的两个容器的信息")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("为什么要搭建自定义网络")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 再次测试使用容器名ping")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker exec -it tomcat-net-01 ping tomcat-net-02")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发现可以成功ping通，2 ping 1也能ping通")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker exec -it tomcat-net-02 ping tomcat-net-01")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[s._v("好处：\n"),a("ul",[a("li",[s._v("部署集群时，如mysql集群使用同一个网桥，使其能够相互访问")]),s._v(" "),a("li",[s._v("不同集群、应用使用不同的网桥，做网络隔离")]),s._v(" "),a("li",[s._v("有利于集群的健康安全，方便网络管理")])])])])])]),s._v(" "),a("h3",{attrs:{id:"网络连通"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#网络连通"}},[s._v("#")]),s._v(" 网络连通")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在docker0网段启动一个tomcat01容器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker run -d -P --name tomcat01 tomcat")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker exec -it tomcat01 ping 192.168.0.2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 192.168.0.2是mynet网段的tomcat-net-01，发现无法ping通")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 尝试打通 tomcat01 - mynet")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker network connect mynet tomcat01")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看发生了什么事情")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker network inspect mynet")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"d31fbe4cbc827494539ed460771233dce4f90dc6ede8eec4502b6d6e113a3535"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tomcat01"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EndpointID"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"90888c8403c19fd47f964b3be22216cfbcc5be59fbf3c9fb8d16fc8ad4240e72"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MacAddress"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"02:42:c0:a8:00:04"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPv4Address"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.0.4/16"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPv6Address"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发现docker将tomcat01放到了mynet网络下 (一个容器，两个ip)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 再次尝试ping")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker exec -it tomcat01 ping 192.168.0.2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker exec -it tomcat01 ping tomcat-net-01")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker exec -it tomcat-net-01 ping tomcat01")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发现都能成功ping通")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h3",{attrs:{id:"实战-部署redis集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实战-部署redis集群"}},[s._v("#")]),s._v(" 实战：部署Redis集群")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新建一个网络")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker network create redis --subnet 172.38.0.0/16")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过shell脚本创建六个redis配置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /mydata/redis/node-"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${port}")]),s._v("/conf\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" /mydata/redis/node-"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${port}")]),s._v("/conf/redis.conf\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/mydata/redis/node-"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${port}")]),s._v("/conf/redis.conf")]),s._v("\nport 6379 \nbind 0.0.0.0\ncluster-enabled yes \ncluster-config-file nodes.conf\ncluster-node-timeout 5000\ncluster-announce-ip 172.38.0.1"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${port}")]),s._v("\ncluster-announce-port 6379\ncluster-announce-bus-port 16379\nappendonly yes\nEOF")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动6个redis")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\ndocker run -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("637")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${port}")]),s._v(":6379 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1637")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${port}")]),s._v(":16379 --name redis-"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${port}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-v /mydata/redis/node-"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${port}")]),s._v("/data:/data "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-v /mydata/redis/node-"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${port}")]),s._v("/conf/redis.conf:/etc/redis/redis.conf "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-d --net redis --ip "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.38")]),s._v(".0.1"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${port}")]),s._v(" redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入一个redis容器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker exec -it redis-1 /bin/sh")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建集群")]),s._v("\n/data "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16:6379 --cluster-replicas 1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入集群")]),s._v("\n/data "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis-cli -c")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看集群信息")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" cluster info\ncluster_statF:ok\ncluster_slots_assigned:16384\ncluster_slots_ok:16384\ncluster_slots_pfail:0\ncluster_slots_fail:0\ncluster_known_nodes:6\ncluster_sizF:3\ncluster_current_epoch:6\ncluster_my_epoch:1\ncluster_stats_messages_ping_sent:145\ncluster_stats_messages_pong_sent:147\ncluster_stats_messages_sent:292\ncluster_stats_messages_ping_received:142\ncluster_stats_messages_pong_received:145\ncluster_stats_messages_meet_received:5\ncluster_stats_messages_received:292\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看集群节点，发现成功形成主从关系")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" cluster nodes\n1b4267a343dc7510f0d78b4ed87cf637df2e6190 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.38")]),s._v(".0.14:6379@16379 slave 5bf4ff85465cb85be5f333878d64c26525f591a2 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1622189569017")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" connected\n614c3d76ecbeff56a4d727533a9f5de2527e434d "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.38")]),s._v(".0.15:6379@16379 slave 40243195691643a053b07feec792a418f5cd9681 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1622189569521")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" connected\n5bf4ff85465cb85be5f333878d64c26525f591a2 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.38")]),s._v(".0.13:6379@16379 master - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1622189568514")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" connected "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10923")]),s._v("-16383\n46d3d62a3390855bdc2e1651fc101684bc35d160 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.38")]),s._v(".0.12:6379@16379 master - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1622189567507")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" connected "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5461")]),s._v("-10922\nb5659d13659210cf88d7accf4d9e715227d8e249 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.38")]),s._v(".0.16:6379@16379 slave 46d3d62a3390855bdc2e1651fc101684bc35d160 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1622189568514")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" connected\n40243195691643a053b07feec792a418f5cd9681 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.38")]),s._v(".0.11:6379@16379 myself,master - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1622189568000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" connected "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-5460\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试可用性，随意设个值，然后关闭存有该值的redis")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" a b\n-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Redirected to slot "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15495")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" located at "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.38")]),s._v(".0.13:6379\nOK\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭该redis容器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker stop redis-3")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回重新进入集群")]),s._v("\n/data "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis-cli -c")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发现能成功获取到值")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" get a\n-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Redirected to slot "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15495")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" located at "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.38")]),s._v(".0.14:6379\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"b"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br")])]),a("h2",{attrs:{id:"springboot微服务打包docker镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#springboot微服务打包docker镜像"}},[s._v("#")]),s._v(" SpringBoot微服务打包Docker镜像")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("创建springboot项目")])]),s._v(" "),a("li",[a("p",[s._v("打包应用："),a("code",[s._v("package")])])]),s._v(" "),a("li",[a("p",[s._v("编写dockerfile (在idea下载docker插件，可以有dockerfile高亮和提示)")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" java:8")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" *.jar /app.jar")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--server.port=8080"')]),s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 8080")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-jar"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/app.jar"')]),s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("构建镜像："),a("code",[s._v("docker build -t cbcbcbc .")])])]),s._v(" "),a("li",[a("p",[s._v("发布运行："),a("code",[s._v("docker run -d -P --name cbcbcbc-web cbcbcbc")])])])])])}),[],!1,null,null,null);t.default=e.exports}}]);